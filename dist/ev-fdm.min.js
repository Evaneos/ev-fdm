/*! ev-fdm 23-05-2014 */
function MenuManagerProvider(){function a(a){return _(f).find(function(b){return 0===a.indexOf(b.state)})}function b(){return _(f).findWhere({active:!0})}function c(a){h&&(h.active=!1),h=a,g=b(),a&&(a.active=!0),g&&(g.active=!1)}function d(){return null!==h}function e(){g=null,h=null}var f=[],g=null,h=null;this.addTab=function(a){return f.push(a),this},this.$get=["$rootScope","$state",function(i,j){return i.$on("$stateChangeStart",function(b,d,e,f){if(""===f.name){var g=a(d.name);c(g)}}),i.$on("$stateChangeSuccess",function(){e();var c=b();c&&(c.active=!1);var d=a(j.current.name);d&&(d.active=!0)}),i.$on("$stateChangeError",function(){h&&(h.active=!1),g&&(g.active=!0),e()}),{tabs:f,selectTab:c,isResolving:d}}]}function EvMenuDirective(a){return{restrict:"E",replace:!0,template:'<ul class="lisette-module-tabs nav nav-tabs" ng-cloak><li ng-repeat="tab in tabs" ng-class="{active: tab.active}"><a ng-click="selectTab(tab)">{{ tab.name }}</a></li></ul>',controller:["$scope","$state",function(b,c){b.tabs=a.tabs,b.selectTab=function(b){a.isResolving()||(a.selectTab(b),c.go(b.state))}}]}}function FilterServiceFactory(a,b){function c(){this.filters={};var c=[],d=this;a.$watch(function(){return d.filters},function(a,c){c!==a&&b(function(){d.modifier?d.modifier.call(d,a,c):d.callListeners()},0)},!0),this.setModifier=function(a){angular.isFunction(a)&&(this.modifier=a)},this.addListener=function(a,b){angular.isFunction(b)&&(c.push(b),a.$on("$destroy",function(){d.removeListener(b)}))},this.removeListener=function(a){angular.forEach(c,function(b,d){b===a&&c.splice(d,1)})},this.callListeners=function(){var a=this;angular.forEach(c,function(b){b(a.filters)})}}return new c}function AjaxStorage(a,b,c,d){function e(c){if(c.cache){var e=JSON.stringify(c),g=f.get(e);if(g)return g}c.id=Fanny.Utils.generateId("proxy:request:");var h={url:"/backoffice/common/xhr",method:"POST",responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:c},i=a(h).then(function(a){return a.data.success?a.data.result[c.id].data:(d.warn(a.data.error,a.data.errors),b.reject(a.data.result[c.id]))});return c.cache&&f.put(e,i),i}var f=c("customHttpCache");return{launchRequest:e}}function Storage(a){return{get:function(b){return a.launchRequest(b)}}}var commonModule=angular.module("ev-fdm",["ui.date","chieffancypants.loadingBar","ui.bootstrap.tooltip","ui.select2","angularMoment","ngAnimate","ui.router","checklist-model","ui.bootstrap"]);commonModule.config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1,a.parentSelector="#lisette-menu"}]),commonModule.config(["$tooltipProvider",function(a){a.options({placement:"bottom",popupDelay:100})}]),commonModule.run(["$rootScope","$state","$location","NotificationsService","uiSelect2Config",function(a,b,c,d,e){e.minimumResultsForSearch=7,e.allowClear=!0,window.moment.lang([window.navigator.language,"en"]),a.$on("$stateChangeStart",function(a,c){b.nextState=c,b.current.name&&0===c.name.indexOf(b.current.name)||$("body").addClass("state-resolving")}),a.$on("$stateChangeError",function(){d.add({text:"Loading error",type:d.type.ERROR})})}]);var NotificationsController=["$scope","NotificationsService",function(a,b){a.notifications=b.list,a.$watch(function(){return b.activeNotification},function(){a.activeNotification=b.activeNotification}),a.getClass=function(a){if(!a)return"";switch(a.type){case b.type.ERROR:return"danger";case b.type.SUCCESS:return"success";case b.type.WARNING:return"warning";case b.type.INFO:return"info";default:return"success"}},a.remove=function(a){b.remove(a)}}];angular.module("ev-fdm").controller("NotificationsController",NotificationsController);var TranslationController=["$rootScope","$scope","SidonieModalService","NotificationsService",function(a,b,c,d){var e=function(a,b){b.key=a,$.ajax({url:BASE_URL+"betty/translation/update",type:"post",dataType:"json",data:{translations:[b]},success:function(a){"undefined"==typeof a.success||a.success||d.addError({text:t("Oops ! Il y a eu un problème lors de la sauvegarde de cette traduction")})}}),d.addSuccess({text:t("Modification prise en compte au prochain rechargement de la page")})};b.displayTranslationPopup=function(){c.open("right","translation.modal",{templateUrl:"translationsEditor.phtml",controller:["$scope",function(a){a.translationsList=evaneos.availableTranslations,a.updateTranslation=e}],backdrop:!1})}}];angular.module("ev-fdm").controller("TranslationController",TranslationController),angular.module("ev-fdm").directive("activableSet",function(){return{restrict:"A",controller:["$scope","$attrs","$parse",function(a,b,c){this.activeElement;var d=c(b.activeElement),e=d.assign,f=this;a.$watch(function(){return d(a)},function(a){f.activeElement=a}),this.toggleActive=function(c){c!==this.activeElement?(e&&e(a,c),this.activeElement=c):(e&&e(a,null),this.activeElement=void 0),a.$eval(b.activeChange)}}]}}).directive("activable",function(){return{restrict:"A",require:"^activableSet",link:function(a,b,c,d){b.addClass("clickable");var e=a[c.activable];a.$watch(function(){return d.activeElement},function(a){a&&e===a?b.addClass("active"):b.removeClass("active")}),b.on("click",function(b){$(b.target).closest(".block-active").length||b.ctrlKey||b.shiftKey||a.$apply(function(){d.toggleActive(e)})})}}});var module=angular.module("ev-fdm");module.directive("clearable",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=angular.element('<button class="clear" ng-click="clear()">×</button>');b.after(e),e.on("click",function(){a.$apply(function(){b.val(""),d.$setViewValue("")})}),a.$watch(function(){return d.$isEmpty(d.$viewValue)},function(a){a?e.hide():e.show()})}}}]),angular.module("ev-fdm").directive("evDatepicker",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e="false"!==c.futurAllowed,f=c.dateFormat||"dd/mm/yy";$(function(){b.datepicker({dateFormat:f,maxDate:e?null:0,onSelect:function(b){d.$setViewValue(b),a.$apply()}})})}}}),angular.module("ev-fdm").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),angular.module("ev-fdm").provider("menuManager",[MenuManagerProvider]).directive("evMenu",["menuManager",EvMenuDirective]);var module=angular.module("ev-fdm");module.directive("evFilters",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"filters.phtml"}}),angular.module("ev-fdm").directive("evFixedHeaders",["$timeout",function(a){function b(a){var b=a.find("thead > tr"),c=a.find("tbody > tr").first();if(b.length){if(!c.length)return b.addClass("uniform"),void d(b,a.outerWidth());b.removeClass("uniform");var e=0,f=b.find("th");f.each(function(){var a=c.find("td:nth-child("+(1+e)+")");a.is(":visible")?($(this).css("width",a.outerWidth()).show(),$(this).css("maxWidth",a.outerWidth()).show()):$(this).hide(),e++})}}function c(c){a(function(){b(c)},0,!1)}function d(a,b){var c=a.find("th");c.length&&c.each(function(){$(this).css("width",b/c.length+"px")})}return{restrict:"A",replace:!1,scope:{rows:"="},link:function(a,d){var e=$(d);e.addClass("fixed-headers"),$(window).on("resize",function(){b(e)}),a.$on("module-layout-changed",function(){b(e)}),a.$watch("rows",function(){c(e)},!0),c(e)}}}]);var module=angular.module("ev-fdm").directive("evFlag",function(){return{restrict:"E",replace:!0,scope:{lang:"="},template:'<i class="icon icon-flag flag-{{lang}}"></i>'}});angular.module("ev-fdm").directive("linkDisabled",function(){return{restrict:"A",link:function(a,b,c){var d=c.ngClick;d&&a.$watch(c.linkDisabled,function(e,f){e?(b.unbind("click"),b.attr("disabled","disabled")):f&&(c.$set("ngClick",d),b.bind("click",function(){a.$apply(c.ngClick)}),b.removeAttr("disabled"))})}}});var module=angular.module("ev-fdm").directive("evLoadingDots",function(){return{restrict:"E",replace:!0,template:'<span class="loading-dots"><span></span><span></span><span></span></span>'}});angular.module("ev-fdm").directive("evModule",["$timeout","$rootScope",function(a,b){function c(a){return function(){angular.forEach(d,function(b,c){var d=a.find(".lisette-module-"+c),e="has-"+c;a.removeClass(_(b.versions).map(function(a){return c+"-"+a}).join(" ")),d.length?(a.addClass(e),angular.forEach(b.versions,function(b){d.hasClass("version-"+b)&&a.addClass(c+"-"+b)})):a.removeClass(e)}),b.$broadcast("module-layout-changed")}}var d={tabs:{versions:[]},topbar:{versions:["size-mini","size-default","size-big"]},leftbar:{versions:[]},bottombar:{versions:[]}};return{restrict:"A",link:function(b,d){d.addClass("lisette-module"),b.$on("$stateChangeSuccess",function(){a(c(d),0)}),a(c(d),0)}}}]),angular.module("ev-fdm").directive("evModuleHeader",["$timeout",function(a){function b(a){var b=a.find(".lisette-module-header");a.height(b.height()-1),b.affix({offset:{top:1}})}return function(c,d){var e=$(d);a(function(){b(e)},0,!1),$(window).on("resize",function(){b(e)}),c.$on("itemsLoaded",function(){b(e)})}}]),angular.module("ev-fdm").directive("mouseFollower",["$document",function(a){return{restrict:"A",link:function(b,c){c=angular.element(c),c.css("position","absolute"),c.css("z-index",1500),a.on("mousemove",function(a){c.css({left:a.pageX,top:a.pageY})})}}}]);var module=angular.module("ev-fdm").directive("evPagination",[function(){var a="...";return{restrict:"AE",replace:!0,templateUrl:"pagination.phtml",scope:{currPage:"=",nbPage:"=",onPageChange:"="},link:function(b){b.paginationButtons=[],b.prevClass="",b.nextClass="",b.currPage||(b.currPage=1),b.nbPage||(b.nbPage=1),b.generateButtons=function(){var c=2;b.paginationButtons=[],b.paginationButtons.push({value:1,"class":1==b.currPage?"active":""}),b.currPage-c>2&&b.paginationButtons.push({value:a,"class":"disabled"});for(var d=c;d>0;d--)b.currPage-d>1&&b.paginationButtons.push({value:b.currPage-d});1!=b.currPage&&b.currPage!=b.nbPage&&b.paginationButtons.push({value:b.currPage,"class":"active"});for(var d=1;c>=d;d++)b.currPage+d<b.nbPage&&b.paginationButtons.push({value:b.currPage+d});b.currPage+c<b.nbPage-1&&b.paginationButtons.push({value:a,"class":"disabled"}),b.nbPage>1&&b.paginationButtons.push({value:b.nbPage,"class":b.currPage==b.nbPage?"active":""})},b.previousPage=function(){b.currPage>1&&(b.currPage--,angular.isFunction(b.onPageChange)&&b.onPageChange(b.currPage))},b.changePage=function(c){c!=a&&c>=1&&c<=b.nbPage&&(b.currPage=c,angular.isFunction(b.onPageChange)&&b.onPageChange(c))},b.nextPage=function(){b.currPage<b.nbPage&&(b.currPage++,angular.isFunction(b.onPageChange)&&b.onPageChange(b.currPage))},b.$watch("nbPage + currPage",function(){b.generateButtons()})}}}]);angular.module("ev-fdm").directive("promise",[function(){function a(a,b){b.removeClass("promise-resolved promise-resolving promise-empty promise-rejected"),b.addClass(a)}return{restrict:"A",replace:!1,controller:["$scope","$attrs","$parse","$element",function(b,c,d,e){var f=d(c.promise),g=c.emptyMessage,h="false"!==c.promiseDefaultStyles;h&&a("promise-default-styles",e),g&&e.append('<div class="promise-empty-message">'+g+"</div>"),b.$watch(function(){return f(b)},function(b){b?(a("promise-resolving",e),b.then(function(b){return g&&angular.isArray(b)&&!b.length?a("promise-resolved promise-empty",e):a("promise-resolved",e),b},function(){a("promise-rejected",e)})):a("promise-resolved",e)})}]}}]),angular.module("ev-fdm").directive("body",["$rootScope","$state",function(a,b){return{restrict:"E",link:function(c,d){a.$on("$stateChangeStart",function(a,c){b.current.name&&0===c.name.indexOf(b.current.name)||d.addClass("state-resolving")}),a.$on("$stateChangeSuccess",function(){d.removeClass("state-resolving")}),a.$on("$stateChangeError",function(){d.removeClass("state-resolving")})}}}]),angular.module("ev-fdm").directive("selectableSet",[function(){return{restrict:"A",controller:["$scope","$parse","$element","$attrs","$document",function(a,b,c,d,e){function f(a,b){var c,d=g(b),e=Math.min(a,b),f=Math.max(a,b);if(angular.forEach(o,function(a){j(a)}),h(d)){for(var k=e;f>=k;k++)c=g(k),j(c);n=b,o.length=0}else{o.length=0;for(var k=e;f>=k;k++)c=g(k),i(c),o.push(c)}}function g(a){return k.selectableElements[a]}function h(a){return k.selectedElements.indexOf(a)>-1}function i(a){h(a)||k.selectedElements.push(a)}function j(a){var b=k.selectedElements.indexOf(a);b>-1&&k.selectedElements.splice(b,1)}{var k=this,l=16,m=b(d.selectedElements);m.assign}this.selectableElements=[],this.selectedElements=m(a);var n,o=[];a.$watchCollection(function(){return k.selectableElements},function(){k.selectedElements.length=0}),e.on("keydown",function(a){a.keyCode===l&&c.addClass("noselect")}),e.on("keyup",function(a){a.keyCode===l&&c.removeClass("noselect")}),this.toggleSelection=function(a,b){n=b,o.length=0,h(a)?j(a):i(a)},this.toggleSelectAll=function(){if(this.selectedElements.length===this.selectableElements.length)this.selectedElements.length=0;else{angular.forEach(this.selectableElements,function(a){h(a)||i(a)})}},this.shiftedClick=function(a,b){void 0!==typeof n&&f(n,b)}}]}}]).directive("selectable",[function(){return{restrict:"A",require:"^selectableSet",link:function(a,b,c,d){function e(b){b.shiftKey?d.shiftedClick(f,a.$index):(b.ctrlKey||angular.element(b.target).is(".checkbox"))&&d.toggleSelection(f,a.$index)}var f=a[c.selectable];d.selectableElements.push(f),a.$on("$destroy",function(){var a=d.selectableElements.indexOf(f);a>-1&&d.selectableElements.splice(a,1),a=d.selectedElements.indexOf(f),a>-1&&d.selectedElements.splice(a,1)}),a.$watchCollection(function(){return d.selectedElements},function(b){a.selected=b.indexOf(f)>-1}),b.on("click",function(b){a.$apply(function(){e(b)})})}}}]).directive("selectBox",function(){return{restrict:"E",require:"^selectable",replace:!0,template:'<span class="checkbox" ng-class="{ active: selected }"></span>'}}).directive("selectAll",function(){return{restrict:"E",require:"^selectableSet",scope:!0,template:'<span class="checkbox" ng-class="{ active: allSelected }" ng-click="toggleSelectAll()"></span>',link:function(a,b,c,d){a.toggleSelectAll=function(){d.toggleSelectAll()},a.$watchCollection(function(){return d.selectedElements},function(){a.allSelected=d.selectedElements.length===d.selectableElements.length&&0!==d.selectedElements.length})}}}),angular.module("ev-fdm").directive("sortableSet",function(){return{restrict:"A",controller:["$scope","$parse","$element","$attrs",function(a,b,c,d){var e=this;this.reverseSort=!1,this.sortKey="",a.reverseSort=a.reverseSort||!1;var f=b(d.reverseSort),g=f.assign,h=b(d.sortBy),i=h.assign;a.$watch(function(){return f(a)},function(a){e.reverseSort=a}),a.$watch(function(){return h(a)},function(a){e.sortKey=a}),this.sortBy=function(b){b==this.sortKey?this.reverseSort=!this.reverseSort:(this.reverseSort=!1,this.sortKey=b),g&&g(a,this.reverseSort),i&&i(a,this.sortKey),a.$eval(d.sortChange)}}]}}).directive("sortable",function(){return{restrict:"A",require:"^sortableSet",link:function(a,b,c,d){function e(){d.sortKey===f?(b.removeClass("no-sort"),d.reverseSort?b.removeClass("sort-down").addClass("sort-up"):b.removeClass("sort-up").addClass("sort-down")):b.removeClass("sort-up sort-down").addClass("no-sort")}var f=c.sortable;b.addClass("sortable sort"),a.$watch(function(){return d.sortKey},function(){e()}),a.$watch(function(){return d.reverseSort},function(){e()}),b.on("click",function(){a.$apply(function(){d.sortBy(f)})})}}});var module=angular.module("ev-fdm");module.directive("throttle",["$timeout",function(a){return{restrict:"A",require:"ngModel",priority:1,link:function(b,c,d,e){var f=e.$setViewValue,g=angular.copy(e.$viewChangeListeners);e.$viewChangeListeners=[];var h;e.$setViewValue=function(b){var c=e.$modelValue!==b;f.apply(e,[b]),c&&(h&&a.cancel(h),h=a(function(){angular.forEach(g,function(a){try{a()}catch(b){$exceptionHandler(b)}})},600))}}}}]),angular.module("ev-fdm").directive("evValue",function(){return{restrict:"E",replace:!0,scope:{value:"=",noValue:"@"},templateUrl:"value.phtml"}}),angular.module("ev-fdm").factory("FilterService",["$rootScope","$timeout",FilterServiceFactory]),"undefined"==typeof Fanny&&(Fanny={}),Fanny.Utils={generatedIds:{},generateId:function(a){var b=a+1e4*Math.random();return this.generatedIds[b]=!0,b},convertNumberToString:function(a,b,c){var d=" ",e=",",f="",g=[],h="",i="",j="";if("undefined"==typeof b&&(b=2),f=a+"",g=f.split("."),g.length<1&&g.length>2)throw new Error("Invalid number");if(h=g[0],1==g.length){i="";for(var k=0;b>k;k++)i+="0"}else if(i=g[1],i.length>b)i=i.substring(0,2);else for(;i.length<b;)i+="0";for(var k=0;k<h.length;k++)k%3==0&&0!=k&&(j=d+j),j=h[h.length-k-1]+j;""==j&&(j="0");for(var k=j.length;c>k;k++)j="0"+j;return i.length>0&&(j+=e+i),j},stringToVar:function(a){if("string"!=typeof a)throw new Error("Not a string");if(!isNaN(a))return parseInt(a);for(var b=a.split("."),c=window,d=0;d<b.length;d++){if(!b[d].length||"undefined"==typeof c[b[d]])throw new Error("No corresponding var found for "+a);c=c[b[d]]}return c},formatDate:function(a){if(!a||"object"!=typeof a)return"";var b=a.getFullYear(),c=this.convertNumberToString(a.getMonth()+1,0,2),d=this.convertNumberToString(a.getDate(),0,2);return b+"-"+c+"-"+d},Renderers:{date:function(a){var b=null,c=null;return b=a&&"object"==typeof a?a.date:a,"string"==typeof b&&b?(b=b.split(" ")[0],c=b.split("-"),3===c.length?c[2]+"/"+c[1]+"/"+c[0]:""):""},amounts:function(a){var b=Fanny.Utils.convertNumberToString(a,2);return a>=0?b:$("<span>").addClass("text-orange").html(b)},money:function(a,b){var c=b&&b.currency&&b.currency.symbole?b.currency.symbole:"€",d=Fanny.Utils.convertNumberToString(a,2)+" "+c;return a>=0?d:$("<span>").addClass("text-orange").html(d)},euros:function(a){var b=Fanny.Utils.convertNumberToString(a,2)+" €";return a>=0?b:$("<span>").addClass("text-orange").html(b)},upper:function(a){return"string"==typeof a?a.toUpperCase():a}}},angular.module("ev-fdm").filter("cleanupDate",function(){return function(a){var b="";if(a){var c=a.slice(0,4),d=a.slice(5,7),e=a.slice(8,10);b=e+"/"+d+"/"+c}return b}}),angular.module("ev-fdm").filter("cssify",function(){return function(a,b){var c="";if(b)for(var d in b)if(b.hasOwnProperty(d)&&a==d){c=b[d];break}return c}}),angular.module("ev-fdm").filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("ev-fdm").service("FilteringService",["$location",function(){var a={};return{setSelectedFilter:function(b,c){a[b]=void 0!=c&&"undefined"!=c?c:""},getSelectedFilter:function(b){var c="";return"undefined"!=typeof a[b]&&"undefined"!=a[b]&&(c=a[b]),c},getAllFilters:function(){return a}}}]);var module=angular.module("ev-fdm"),ModalService=function(a,b,c,d){this.$rootScope=a,this.$templateCache=b,this.$compile=c,this.$controller=d};ModalService.prototype.open=function(a){a=this._readOptions(a);var b=(a.parentScope||this.$rootScope).$new();b=_(b).extend(a.scope);var c;a.controller&&(c=this.$controller(a.controller,{$scope:b}));var d=this.$compile(a.template||this.$templateCache.get(a.templateUrl))(b);return d.$scope=b,d.$controller=c,c&&(c.$modal=d),$(d).modal(a)},ModalService.prototype._readOptions=function(a){if(a=_({backdrop:!0,scope:{},keyboard:!0}).extend(a),!a.templateUrl&&!a.template)throw new Error("Either template or templateUrl have to be defined");return a},module.service("ModalService",["$rootScope","$templateCache","$compile","$controller",ModalService]);var module=angular.module("ev-fdm");module.service("NotificationsService",["$timeout",function(a){function b(a){a.type||(a.type=i.SUCCESS),e(a)}function c(a){g=_(g).without(a),d()}function d(){if(g.length){var b=g[0];f.activeNotification!==b&&(f.activeNotification=b,-1!==b.delay&&a(function(){c(b)},1e3*(b.delay||h)))}else f.activeNotification=null}function e(a){g.push(a),d()}var f=this,g=[],h=5,i={SUCCESS:0,ERROR:1,INFO:2,WARNING:3};this.activeNotification=null,this.add=b,this.remove=c,this.addError=function(a){a.type=i.ERROR,b(a)},this.addSuccess=function(a){a.type=i.SUCCESS,b(a)},this.type=i}]);var module=angular.module("ev-fdm");module.factory("panelFactory",function(){var a=function(a){this.blockers=[],_(this).extend(a)};return a.prototype.addBlocker=function(a){this.blockers.push(a)},a.prototype.removeBlocker=function(a){this.blockers=_(this.blockers).without(a)},a.prototype.isBlocked=function(a){return _(this.blockers).some(function(b){return b(a)})},{create:function(b){return new a(b)}}}),module.factory("sidonieRegion",function(){function a(a){return function(){throw new Error("Method "+a+" should be overriden")}}var b=function(a){this.hasPush=a,this.panels=_([])};return b.prototype.open=a("open"),b.prototype.close=a("close"),b.prototype.push=function(a){this.panels.push(a)},b.prototype.remove=function(a){var b=this.panels.indexOf(a);return b>-1&&this.panels.splice(b,1),b},b.prototype.at=function(a){return this.panels._wrapped[a]},b.prototype.each=function(){return this.panels.each.apply(this.panels,arguments)},b.prototype.dismissAll=function(a){this.each(function(b){b.dismiss(a)})},b.prototype.last=function(){return this.panels.last()},b.prototype.getNext=function(a){var b=this.panels.indexOf(a);return b<this.panels.size()-1?this.at(b+1):null},b.prototype.getChildren=function(a){var b=this.panels.indexOf(a);return b>-1?this.panels.slice(b+1):[]},b.prototype.size=function(){return this.panels.size()},b.prototype.isEmpty=function(){return 0===this.panels.size()},{create:function(a,c){var d=function(a){return b.call(this,a)};return d.prototype=_({}).extend(b.prototype,c),new d(a)}}}),module.service("PanelService",["$rootScope","$http","$templateCache","$q","$injector","$controller","middleRegion","rightRegion","panelFactory",function(a,b,c,d,e,f,g,h,i){function j(a,b){if(!b.template&&!b.templateUrl&&!b.content)throw new Error("Should define options.template or templateUrl or content");return b.push=b.push||b.pushFrom,b.panelClass=b.panelClass||"",b.panelClass+=" "+a,b.resolve=b.resolve||{},b}function k(a){return a.content?d.when(a.content):a.template?d.when(a.template):b.get(a.templateUrl,{cache:c}).then(function(a){return a.data})}function l(a){var b=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&b.push(d.when(e.invoke(a)))}),b}function m(a){return[k(a)].concat(l(a.resolve))}function n(a){return d.all(m(a)).then(function(b){var c={},d=1;return angular.forEach(a.resolve,function(a,e){c[e]=b[d++]}),{content:b[0],locals:c}})}function o(a){if(_(s).has(a))return s[a];throw new Error("Unknown region "+a)}function p(a,b,c){for(var d=a.getChildren(b),e=d.length-1;e>=0;e--){var f=d[e],g=f.dismiss(c);if(!g)return!1}return!0}function q(b,c){var e=d.defer(),g=d.defer(),h=i.create({result:e.promise,opened:g.promise,close:function(a){if(!h.isBlocked()){var d=p(b,h,"parent closed");return d?(b.close(h,c),b.remove(h),e.resolve(a),!0):!1}return!1},dismiss:function(a){if(!h.isBlocked()){var d=p(b,h,"parent dismissed");return d?(b.close(h,c),b.remove(h),e.reject(a),!0):!1}return!1}});return n(c).then(function(d){var g=(c.scope||a).$new();g.$close=h.close,g.$dismiss=h.dismiss;var i;if(c.controller){var j=d.locals;j.$scope=g,j.$instance=h,i=f(c.controller,j)}c.scope=g,c.deferred=e,c.content=d.content,c.replace?(b.replace(c.replace,h,c),b.remove(c.replace,c)):b.open(h,c)}).then(function(){g.resolve(!0)},function(){g.resolve(!1)}),h}var r=1,s={middle:g,right:h};return{open:function(a,b){b=j(a,b);var c,d=o(a),e=d.last();if(b.push&&!b.pushFrom&&(b.pushFrom=e),b.pushFrom&&b.pushFrom!=e&&(b.replace=d.getNext(b.pushFrom),b.replace)){var f=p(d,b.replace,"parent replaced");if(!f)return!1}return d.hasPush&&b.push||d.isEmpty()||(b.replace=e),b.replace&&b.replace.isBlocked()?!1:(c=q(d,b),c.$$id=r++,c.$$region=a,d.push(c),c)},push:function(a,b){return b.push=!0,this.open(a,b)},dismissAll:function(a){_(s).each(function(b){b.dismissAll(a)})},dismissChildren:function(a,b){var c=s[a.$$region];return p(c,a,b)}}}]);var module=angular.module("ev-fdm"),SidonieModalService=function(a,b,c){function d(b,d,e){var f=g(b),j=f.multi,k=f.opened;if(e.windowClass||(e.windowClass=" fade "),e.windowClass+=" "+b,e.templateUrl||e.template||(e.templateUrl=d+".phtml"),e.backdrop=b==SidonieModalService.REGION_MIDDLE,j)throw new Error("Multi not implemented yet");if(k.length){var l=k[k.length-1];if(l.status==SidonieModalService.STATUS_LOCKED)return c.warn("Open modal aborted due to "+l.sidonieModalType+"'s locked status"),i(l),!1;if(l.sidonieModalType!=d){l.modal("hide");var m=a.open(e);return m.sidonieModalType=d,m.result.finally(h(b,m)),f.opened=[m],m}return l}var m=a.open(e);return m.sidonieModalType=d,m.result.finally(h(b,m)),f.opened=[m],m}function e(){var a=!1;return angular.forEach(j,function(b){angular.forEach(b.opened,function(b){a||b.status==SidonieModalService.STATUS_LOCKED&&(i(b),c.warn("Open modal aborted due to "+b.sidonieModalType+"'s locked status"),a=b)})}),a?a:(angular.forEach(j,function(a){angular.forEach(a.opened,function(a){try{a.close()}catch(b){}})}),!0)}function f(a,b){var c=g(a);if(c.modals.length){var d=c.modals[c.modals.length-1];return b&&d.sidonieModalType!=b?!1:d}}function g(a){var b=j[a];if("undefined"==typeof b)throw new Error("Unknown region "+a);return b}function h(a,b){return function(){var c=g(a);angular.forEach(c.opened,function(a){b==a&&(c.opened=_(c.opened).without(b))})}}function i(a){b.addClass(a,"modal-locked",function(){b.removeClass(a,"modal-locked")})}var j={};return j[SidonieModalService.REGION_RIGHT]={multi:!1,opened:[]},j[SidonieModalService.REGION_MIDDLE]={multi:!1,opened:[]},{open:d,openRight:function(a,b){d(SidonieModalService.REGION_RIGHT,a,b)},openMiddle:function(a,b){d(SidonieModalService.REGION_MIDDLE,a,b)},get:f,closeAll:e}};SidonieModalService.STATUS_LOCKED="locked",SidonieModalService.REGION_RIGHT="right",SidonieModalService.REGION_MIDDLE="middle",module.service("SidonieModalService",["$modal","$animate","$log",SidonieModalService]);var module=angular.module("ev-fdm");module.service("SortService",[function(){var a="",b=!1,c=function(){return a},d=function(c){return c==a?b=!b:a=c,this},e=function(c){var d="sort ";return d+=c==a?b?"sort-up":"sort-down":"no-sort"},f=function(a){b=a},b=function(){return b};return{sortBy:d,getSortCSS:e,getCurrentSort:c,setReverse:f,isReverse:b}}]);var module=angular.module("ev-fdm");module.directive("middlePanelBackdrop",["$timeout",function(a){return{restrict:"EA",replace:!0,template:'<div class="modal-backdrop fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1040 + index*10}"></div>',link:function(b){b.animate=!1,a(function(){b.animate=!0})}}}]),module.directive("middlePanelWindow",["$timeout","middleRegion",function(a,b){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:"panels/middle-window.phtml",link:function(c,d){a(function(){c.animate=!0,d[0].focus()}),c.close=function(a){a.target===a.currentTarget&&(a.preventDefault(),a.stopPropagation(),b.dismissAll())}}}}]),module.service("middleRegion",["$compile","$document","$rootScope","sidonieRegion",function(a,b,c,d){var e={},f=b.find("body").eq(0),g=d.create(!1,{open:function(b,d){var g,h;g=angular.element("<div middle-panel-backdrop></div>"),h=a(g)(c.$new(!0)),f.append(h);var i=angular.element("<div middle-panel-window></div>");i.addClass(d.panelClass),i.html(d.content);var j=a(i)(d.scope);return f.append(j),e[b.$$id]={window:j,backdrop:h},b},replace:function(){throw new Error("Not implemented")},close:function(a){"undefined"!=typeof e[a.$$id]&&(e[a.$$id].window.remove(),e[a.$$id].backdrop.remove(),delete e[a.$$id])}});return b.bind("keydown",function(a){if(27===a.which){var b=g.last();b&&c.$apply(function(){b.dismiss("escape")})}}),g}]);var module=angular.module("ev-fdm");module.directive("rightPanelWindow",["$timeout",function(a){function b(a){var b,c;for(c=0;c<d.length;c++)if(a<d[c]){b=d[c];break}return b?c:-1}function c(a,b){var c="";c=-1==b?"max":d[b],a.attr("data-breakpoint",c)}var d=[100,200,300,400,500,600,700];return{restrict:"A",replace:!0,transclude:!0,templateUrl:"panels/right-window.phtml",link:function(d,e){e.resizable({handles:"w",resize:function(a,d){var f=b(d.size.width);c(e,f)}}),d.$on("animation-complete",function(){var a=b(e.outerWidth());c(e,a)}),a(function(){var a=b(e.outerWidth());c(e,a),e[0].focus()})}}}]),module.service("rightRegion",["$rootScope","$compile","$animate","$timeout","sidonieRegion",function(a,b,c,d,e){function f(a){return k[a.$$id]?k[a.$$id]:null}function g(a,b){var c=m[a.$$depth+"-"+b.panelClass];return c?'style="width: '+c+'px;"':""}function h(a){for(var b=0;b<n.panels.size();b++){var d=a>b,e=n.at(b),g=f(e);e.$$stacked&&!d?(delete e.$$actualWidth,c.removeClass(g,"stacked")):!e.$$stacked&&d&&(e.$$actualWidth=f(e).outerWidth(),c.addClass(g,"stacked")),e.$$stacked=d}}function i(){for(var a=$(window).innerWidth()-100,b=0;b<n.panels.size();b++){var c=0,d=_(n.panels).reduce(function(a,d){if(c++<b)return a+j;var e=f(d);if(!e)return a;if(d.$$stacked)return a+d.$$actualWidth;var g=e.outerWidth();return 50>g?a+300:a+g},0);if(a>d)return h(b)}h(n.panels.size()-1)}var j=15,k={},l=_(i).debounce(50);$(window).on("resize",function(){n.updateStacking()});var m=window.stylesCache={},n=e.create(!0,{updateStacking:function(){return d(l)},open:function(d,e){d.$$depth=n.panels.size();var f=angular.element('<div class="panel-placeholder"></div>'),h=angular.element("<div right-panel-window "+g(d,e)+"></div>");return h.html(e.content),e.scope.panelClass=e.panelClass,h=b(h)(e.scope),f.html(h),k[d.$$id]=f,c.enter(f,$(".lisette-module-region.right"),null,function(){e.scope.$emit("animation-complete"),a.$broadcast("module-layout-changed"),n.updateStacking()}),f.on("resize",function(a,b){m[d.$$depth+"-"+e.panelClass]=b.size.width,n.updateStacking()}),n.updateStacking(),d},replace:function(a,c,d){if("undefined"!=typeof k[a.$$id]){var e=k[a.$$id];c.$$depth=n.panels.size()-1;var f=angular.element("<div right-panel-window "+g(c,d)+"></div>");return f.html(d.content),d.scope.panelClass=d.panelClass,f=b(f)(d.scope),e.html(f),k[c.$$id]=e,delete k[a.$$id],n.updateStacking(),c}return n.open(c,d)},close:function(a){if("undefined"!=typeof k[a.$$id]){var b=k[a.$$id];c.leave(b,function(){delete k[a.$$id],n.updateStacking()}),n.updateStacking()}}});return n}]);var module=angular.module("ev-fdm"),AbstractAutocompleteStorage=function(a,b){_.extend(this,a),this.AbstractStorage=a,this.$timeout=b};AbstractAutocompleteStorage.prototype.generateAutocompleteConfig=function(a,b,c){var d,e=this;return{minimumInputLength:c,allowClear:!0,initSelection:function(){return""},query:function(c){var f=c.term;d&&e.$timeout.cancel(d),d=e.$timeout(function(){a.call(e,f.toUpperCase()).then(function(a){var d=b(a);c.callback({results:d})})},600)}}},module.service("AbstractAutocompleteStorage",["Storage","$timeout",AbstractAutocompleteStorage]),angular.module("ev-fdm").service("AjaxStorage",["$http","$q","$cacheFactory","$log",AjaxStorage]);var module=angular.module("ev-fdm");module.service("Storage",["AjaxStorage",Storage]);var angularLocalStorage=angular.module("LocalStorageModule",[]);angularLocalStorage.value("prefix","ls"),angularLocalStorage.constant("cookie",{expiry:30,path:"/"}),angularLocalStorage.constant("notify",{setItem:!0,removeItem:!1}),angularLocalStorage.service("localStorageService",["$rootScope","prefix","cookie","notify",function(a,b,c,d){"."!==b.substr(-1)&&(b=b?b+".":"");var e=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}},f=function(c,f){if(!e())return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),d.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:c,newvalue:f,storageType:"cookie"}),l(c,f);"undefined"==typeof f&&(f=null);try{(angular.isObject(f)||angular.isArray(f))&&(f=angular.toJson(f)),localStorage.setItem(b+c,f),d.setItem&&a.$broadcast("LocalStorageModule.notification.setitem",{key:c,newvalue:f,storageType:"localStorage"})}catch(g){return a.$broadcast("LocalStorageModule.notification.error",g.message),l(c,f)
}return!0},g=function(c){if(!e())return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),m(c);var d=localStorage.getItem(b+c);return d?"{"===d.charAt(0)||"["===d.charAt(0)?angular.fromJson(d):d:null},h=function(c){if(!e())return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),d.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:"cookie"}),n(c);try{localStorage.removeItem(b+c),d.removeItem&&a.$broadcast("LocalStorageModule.notification.removeitem",{key:c,storageType:"localStorage"})}catch(f){return a.$broadcast("LocalStorageModule.notification.error",f.message),n(c)}return!0},i=function(){if(!e())return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;var c=b.length,d=[];for(var f in localStorage)if(f.substr(0,c)===b)try{d.push(f.substr(c))}catch(g){return a.$broadcast("LocalStorageModule.notification.error",g.Description),[]}return d},j=function(){if(!e())return a.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),o();var c=b.length;for(var d in localStorage)if(d.substr(0,c)===b)try{h(d.substr(c))}catch(f){return a.$broadcast("LocalStorageModule.notification.error",f.message),o()}return!0},k=function(){try{return navigator.cookieEnabled||"cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1)}catch(b){return a.$broadcast("LocalStorageModule.notification.error",b.message),!1}},l=function(d,e){if("undefined"==typeof e)return!1;if(!k())return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var f="",g=new Date;null===e&&(c.expiry=-1,e=""),0!==c.expiry&&(g.setTime(g.getTime()+24*c.expiry*60*60*1e3),f="; expires="+g.toGMTString()),d&&(document.cookie=b+d+"="+encodeURIComponent(e)+f+"; path="+c.path)}catch(h){return a.$broadcast("LocalStorageModule.notification.error",h.message),!1}return!0},m=function(c){if(!k())return a.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var d=document.cookie.split(";"),e=0;e<d.length;e++){for(var f=d[e];" "==f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(b+c+"="))return decodeURIComponent(f.substring(b.length+c.length+1,f.length))}return null},n=function(a){l(a,null)},o=function(){for(var a=null,c=b.length,d=document.cookie.split(";"),e=0;e<d.length;e++){for(a=d[e];" "==a.charAt(0);)a=a.substring(1,a.length);key=a.substring(c,a.indexOf("=")),n(key)}};return{isSupported:e,set:f,add:f,get:g,keys:i,remove:h,clearAll:j,cookie:{set:l,add:l,get:m,remove:n,clearAll:o}}}]);