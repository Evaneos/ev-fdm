{"version":3,"sources":["LeafletDirective.js"],"names":["angular","module","provider","this","$get","icons","tiles","setIcons","setTiles","directive","leafletData","evLeaflet","$log","template","restrict","scope","coordinates","defaultCoordinates","boundingbox","editable","controller","$scope","centerOnMarkerOrBoungingbox","bounds","southWest","lat","southLatitude","lng","westLongitude","northEast","northLatitude","eastLongitude","center","markers","marker","zoom","baseIcon","iconSize","shadowSize","iconAnchor","extend","copy","draggable","defaults","scrollWheelZoom","doubleClickZoom","focus","$watch","isNaN","latitude","warn","longitude","previousBoundingbox","equals","edited","icon"],"mappings":"AAAAA,QAAAC,OAAA,cAAA,sBACAC,SAAA,YAAA,WACAC,KAAAC,KAAA,WACA,OACAC,MAAAF,KAAAE,MACAC,MAAAH,KAAAG,QAIAH,KAAAI,SAAA,SAAAF,GACAF,KAAAE,MAAAA,GAGAF,KAAAK,SAAA,SAAAF,GACAH,KAAAG,MAAAA,KAGAG,UAAA,aAAA,cAAA,YAAA,OAAA,SAAAC,EAAAC,EAAAC,GACA,OACAC,SAAA,6HACAC,SAAA,KACAC,OACAC,YAAA,IACAC,mBAAA,KACAC,YAAA,KACAC,SAAA,KAEAC,WAAA,SAAAC,GAsFA,QAAAC,KACA,MAAAD,GAAAH,iBACAG,EAAAE,QACAC,WACAC,IAAAJ,EAAAH,YAAAQ,cACAC,IAAAN,EAAAH,YAAAU,eAEAC,WACAJ,IAAAJ,EAAAH,YAAAY,cACAH,IAAAN,EAAAH,YAAAa,sBAKAV,EAAAW,QAOAX,EAAAW,OAAAP,IAAAJ,EAAAY,QAAAC,OAAAT,IACAJ,EAAAW,OAAAL,IAAAN,EAAAY,QAAAC,OAAAP,KAPAN,EAAAW,QACAP,IAAAJ,EAAAY,QAAAC,OAAAT,IACAE,IAAAN,EAAAY,QAAAC,OAAAP,IACAQ,KAAA,IArGA,GAAAC,IACAC,UAAA,GAAA,IACAC,YAAA,EAAA,GACAC,YAAA,EAAA,KAGAlC,EAAAM,EAAAN,KAEA,YAAAA,IACAL,QAAAwC,OAAAxC,QAAAyC,KAAAL,GAAA/B,EAAAA,YAEA,aAAAA,IACAL,QAAAwC,OAAAxC,QAAAyC,KAAAL,GAAA/B,EAAAqC,UAGA,IAAApC,GAAAK,EAAAL,KACAA,KACAe,EAAAf,MAAAA,GAGAe,EAAAsB,UACAC,iBAAA,EACAC,iBAAA,GAIAxB,EAAAY,SACAC,QACAY,OAAA,IAKAzB,EAAA0B,OAAA,uBAAA,SAAAtB,IACAuB,MAAAvB,IAAA,MAAAA,KAEAA,EADAJ,EAAAJ,oBAAA,MAAAI,EAAAJ,mBAAAgC,SACA5B,EAAAJ,mBAAAgC,SAEA,EAEArC,EAAAsC,KAAA,yCAEA7B,EAAAY,QAAAC,OAAAT,IAAAA,EACAH,MAGAD,EAAA0B,OAAA,wBAAA,SAAApB,IACAqB,MAAArB,IAAA,MAAAA,KAEAA,EADAN,EAAAJ,oBAAA,MAAAI,EAAAJ,mBAAAkC,UACA9B,EAAAJ,mBAAAkC,UAEA,EAEAvC,EAAAsC,KAAA,0CAEA7B,EAAAY,QAAAC,OAAAP,IAAAA,EACAL,MAGAA,GAEA,IAAA8B,GAAA/B,EAAAH,WAEAG,GAAA0B,OAAA,cAAA,SAAA7B,GACAA,IAAAlB,QAAAqD,OAAAnC,EAAAkC,KACAA,EAAAlC,EACAI,OAIAD,EAAA0B,OAAA,qBAAA,SAAAtB,GACA,MAAAA,GAAAJ,EAAAF,WACAE,EAAAL,YAAAiC,SAAAxB,KAIAJ,EAAA0B,OAAA,qBAAA,SAAApB,GACA,MAAAA,GAAAN,EAAAF,WACAE,EAAAL,YAAAmC,UAAAxB,KA+BAN,EAAA0B,OAAA,WAAA,WACA,GAAAO,GAAAjC,EAAAF,QACAE,GAAAY,QAAAC,OAAAqB,KAAAD,EAAAjD,EAAAqC,UAAArC,EAAA,WACAgB,EAAAY,QAAAC,OAAAQ,UAAAY","file":"ev-fdm-leaflet.min.js","sourcesContent":["angular.module('ev-leaflet', ['leaflet-directive'])\n    .provider('evLeaflet', function() {\n        this.$get = function() {\n            return {\n                icons: this.icons,\n                tiles: this.tiles\n            };\n        };\n\n        this.setIcons = function(icons) {\n            this.icons = icons;\n        };\n\n        this.setTiles = function(tiles) {\n            this.tiles = tiles;\n        };\n    })\n    .directive('evLeaflet', ['leafletData', 'evLeaflet', '$log', function (leafletData, evLeaflet, $log) {\n        return {\n            template: '<leaflet class=\"ev-leaflet\" defaults=\"defaults\" markers=\"markers\" center=\"center\" tiles=\"tiles\" bounds=\"bounds\"></leaflet>',\n            restrict: 'AE',\n            scope: {\n                coordinates: '=',\n                defaultCoordinates: '=?',\n                boundingbox: '=?',\n                editable: '='\n            },\n            controller: function($scope) {\n\n                // Icons settings\n                var baseIcon = {\n                    iconSize:   [40, 40],\n                    shadowSize: [1, 1],\n                    iconAnchor: [1, 20]\n                };\n\n                var icons = evLeaflet.icons;\n\n                if ('default' in icons) {\n                    angular.extend(angular.copy(baseIcon), icons.default);\n                }\n                if ('draggable' in icons) {\n                    angular.extend(angular.copy(baseIcon), icons.draggable);\n                }\n\n                var tiles = evLeaflet.tiles;\n                if (tiles) {\n                    $scope.tiles = tiles;\n                }\n\n                $scope.defaults = {\n                    scrollWheelZoom: false,\n                    doubleClickZoom: false\n                };\n\n                // Setting a marker in location\n                $scope.markers = {\n                    marker: {\n                        focus: true\n                    }\n                };\n\n                // Double binding between coordinates and marker's position\n                $scope.$watch('coordinates.latitude', function(lat) {\n                    if (isNaN(lat) || lat == null) { // simple == : null or undefined\n                        if ($scope.defaultCoordinates && $scope.defaultCoordinates.latitude != null) {\n                            lat = $scope.defaultCoordinates.latitude;\n                        } else {\n                            lat = 0;\n                        }\n                        $log.warn('ev-leaflet: latitude is not a number');\n                    }\n                    $scope.markers.marker.lat = lat;\n                    centerOnMarkerOrBoungingbox();\n                });\n\n                $scope.$watch('coordinates.longitude', function(lng) {\n                    if (isNaN(lng) || lng == null) { // simple == : null or undefined\n                        if ($scope.defaultCoordinates && $scope.defaultCoordinates.longitude != null) {\n                            lng = $scope.defaultCoordinates.longitude;\n                        } else {\n                            lng = 0;\n                        }\n                        $log.warn('ev-leaflet: longitude is not a number');\n                    }\n                    $scope.markers.marker.lng = lng;\n                    centerOnMarkerOrBoungingbox();\n                });\n\n                centerOnMarkerOrBoungingbox();\n\n                var previousBoundingbox = $scope.boundingbox;\n\n                $scope.$watch('boundingbox', function(boundingbox) {\n                    if (boundingbox && !angular.equals(boundingbox, previousBoundingbox)) {\n                        previousBoundingbox = boundingbox;\n                        centerOnMarkerOrBoungingbox();\n                    }\n                });\n\n                $scope.$watch('markers.marker.lat', function(lat) {\n                    if (lat != null && $scope.editable) {\n                        $scope.coordinates.latitude = lat;\n                    }\n                });\n\n                $scope.$watch('markers.marker.lng', function(lng) {\n                    if (lng != null && $scope.editable) {\n                        $scope.coordinates.longitude = lng;\n                    }\n                });\n\n                // Setting map center\n                function centerOnMarkerOrBoungingbox() {\n                    if ($scope.boundingbox) {\n                        $scope.bounds = {\n                            southWest: {\n                                lat: $scope.boundingbox.southLatitude,\n                                lng: $scope.boundingbox.westLongitude,\n                            },\n                            northEast: {\n                                lat: $scope.boundingbox.northLatitude,\n                                lng: $scope.boundingbox.eastLongitude,\n                            },\n                        };\n                        return;\n                    }\n                    if (!$scope.center) {\n                        $scope.center = {\n                            lat: $scope.markers.marker.lat,\n                            lng: $scope.markers.marker.lng,\n                            zoom: 8\n                        };\n                    } else {\n                        $scope.center.lat = $scope.markers.marker.lat;\n                        $scope.center.lng = $scope.markers.marker.lng;\n                    }\n                }\n\n                $scope.$watch('editable', function () {\n                    var edited = $scope.editable;\n                    $scope.markers.marker.icon = edited ? icons.draggable : icons['default'];\n                    $scope.markers.marker.draggable = edited;\n                });\n            }\n        };\n    }]);\n"],"sourceRoot":"/source/"}