!function(e){function t(e){var t=e.match(i);return t?t.length:0}var n={menubar:!1,statusbar:!1,toolbar:"bold italic underline | alignleft aligncenter alignright | bullist",skin:!1,verify_html:!0,convert_fonts_to_spans:!0,inline:!0,browser_spellcheck:!0},i=/[\w\u2019\x27\-\u00C0-\u1FFF]+/g;angular.module("ev-tinymce",[]).provider("evTinymce",function(){var e={};this.register=function(t,n){if(e.hasOwnProperty(t))throw new Error('A config named "'+t+'" was already registered');e[t]=n},this.get=function(t){return e[t]},this.$get=function(){return e}}).directive("evTinymce",["$timeout","evTinymce",function(i,o){var r=0;return{template:'<div class="tiny-mce-wrapper form-control"><div class="ev-placeholder-container"></div><div class="ev-tinymce-content"></div><div ng-click="focusTinymce()" class="ev-tinymce-toolbar"></div><div class="counter-info"></div></div>',restrict:"AE",replace:!0,require:"?ngModel",scope:{tinymceOptions:"="},link:function(a,c,l,s){var d="uiTinymce"+r++,u=c.find(".ev-tinymce-content");u.attr("id",d),c.find(".ev-tinymce-toolbar").attr("id",d+"toolbar");var m,v=function(){return m||(m=e.get(d)),m},f=angular.extend({fixed_toolbar_container:"#"+d+"toolbar"},n,o[l.configKey],a.tinymceOptions),g=f.minChars=l.minChars||f.minChars||null,h=f.maxChars=l.maxChars||f.maxChars||null,p=f.minWords=l.minWords||f.minWords||null,C=f.maxWords=l.maxWords||f.maxWords||null,y=85,b=function(e,t,n){var i=c.parent().find(".counter-info");if(i.text(e+(n?" / "+n:"")),n){var o=e/n*100>y;i.toggleClass("counter-warning",o)}var r=t&&t>e,a=n&&e>=n;i.toggleClass("counter-reached",!(!r&&!a))},x=!1,w=!1,T="",A="",M=function(){var e=v();tinymce.DOM.addClass(u,"placeholder-light"),e.setContent(l.placeholder)},k=function(e){var t=v();x?A===l.placeholder&&(t.setContent(""),t.selection.setCursorLocation(),tinymce.DOM.removeClass(u,"placeholder-light")):e!==l.placeholder&&M()},$=function(){var e,n,o,r=v(),a=u.html(),c=u.text(),d=!1,m=!1;if(w&&c===l.placeholder)T=a,A=c,(h||g||C||p)&&(e=0);else if(h||g?e=c.length:(C||p)&&(e=t(c)),g?n=g:p&&(n=p),h?(o=h,d=e>h):C&&(o=C,d=e>C),!d||!m&&A.length)d?r.setContent(T):(i(function(){s.$setViewValue(""===c||c===l.placeholder?"":a)}),T=a,A=c);else{var f=c.substr(0,h);r.setContent(f,{format:"text"})}null!=e&&b(e,n,o),w=""===c||c===l.placeholder,w&&l.placeholder&&k(c)};s.$render=function(){var e=v();e&&(s.$viewValue?e.setContent(s.$viewValue):l.placeholder&&(w=!0,M()))},a.focusTinymce=function(){var e=v();e&&e.focus()};var _=function(e){e.on("init",function(){s.$viewValue&&s.$render()}),e.on("ExecCommand",function(e){$()}),e.on("KeyUp",function(e){$()}),e.on("SetContent",function(e){e.initial||$()}),e.on("blur",function(e){x&&(x=!1,$()),u.blur()}),e.on("focus",function(e){x||(x=!0,$())})};f.setup=_,f.elems=d,f.mode="exact",e.init(f),a.$on("$destroy",function(){var e=v();e&&e.destroy()}),e.execCommand("mceToggleEditor",!1,d)}}}])}(window.tinyMCE),tinymce.PluginManager.add("evelements",function(e){function t(t){return function(){var n=e.dom,i=e.selection.getNode();i&&t.matches(i)?n.remove(i,!0):e.insertContent(n.createHTML(t.name,{},n.encode(e.selection.getContent({format:"text"}))))}}function n(t){return function(){var n=e.dom,i=e.selection.getNode(),r=null;if(i&&t.matches(i)){r={};for(var a=n.getAttribs(i),c=0;c<a.length;++c){var l=a[c];r[l.name]=l.value}}else i=null;var s=t.key||t.name,d=o[s]&&o[s].callback,u=i?"innerText"in i?i.innerText:i.textContent:e.selection.getContent({format:"text"});(d||t.callback)(r,function(o,r){if(i){if(e.focus(),!o&&!r)return n.remove(i,!0),void e.undoManager.add();n.removeAllAttribs(i),n.setAttribs(i,o),r&&("innerText"in i?i.innerText=r:i.textContent=r),e.selection.select(i),e.undoManager.add()}else e.focus(),i=n.createHTML(t.name,o,r&&n.encode(r)),e.selection.setContent(i),e.undoManager.add()},u,o)}}var i=e.settings.evelements,o=e.settings.evelementsOptions;"string"==typeof i&&(i=i.split(" ")),i.forEach(function(i){"string"==typeof i&&(i={name:i}),i.matches=i.matches||function(e){return e.nodeName.toLowerCase()===i.name};var o=i.callback?n(i):t(i);e.addButton("ev"+(i.key||i.name),{text:void 0!==i.title?i.title:i.name,icon:i.icon,tooltip:i.tooltip||"Set this text as "+i.name,shortcut:i.shortcut,onclick:o,stateSelector:i.selector||i.name}),i.shortcut&&e.addShortcut(i.shortcut,"",o)})}),tinymce.PluginManager.add("evimage",function(e){function t(){var t=e.dom,n=e.selection.getNode(),i=null;n&&n.getAttribute("data-picture-id")&&(i={src:t.getAttrib(n,"src"),alt:t.getAttrib(n,"alt"),"class":t.getAttrib(n,"class"),"data-picture-id":t.getAttrib(n,"data-picture-id")}),e.settings.evimage(i,function(o){i?(t.removeAllAttribs(n),t.setAttribs(n,o)):e.selection.setContent(e.dom.createHTML("img",o))})}console.log("evimage is deprecated: use evelements"),e.addButton("evimage",{icon:"image",tooltip:"Insert/edit image",onclick:t,stateSelector:"img[data-picture-id]:not([data-mce-object],[data-mce-placeholder])"}),e.addMenuItem("evimage",{icon:"image",text:"Insert image",onclick:t,context:"insert",prependToContext:!0}),e.addCommand("mceImage",t)});
//# sourceMappingURL=ev-fdm-tinymce.min.js.map
