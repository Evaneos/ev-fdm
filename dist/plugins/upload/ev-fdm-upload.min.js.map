{"version":3,"sources":["app.js","directives/pictureButtonUploadDirective.js","directives/pictureUploadDirective.js","directives/uploadDirective.js"],"names":[],"mappings":"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","file":"ev-fdm-upload.min.js","sourcesContent":["(function () {\n    'use strict';\n    angular.module('ev-upload', ['ev-fdm']);\n}) ();","; (function () {\n'use strict';\nangular.module('ev-upload')\n    .directive('evPictureButtonUpload', ['NotificationsService', '$http', function (NotificationsService, $http) {\n\n/*  ev-picture-button-upload\n    =================\n    Hi! I'm a directive used for uploading pictures but I'm just a button.\n    If you want a more advanced one, you can use the evPictureUpload\n\n    You can parameter me with:\n    - `url`:  which is the place where I'll upload the pictures\n    - `pictureSuccess`:  a function called each time a picture has successfully been uploaded (by flickr\n        or manually). The picture is passed as argument.\n\n*/\n        return {\n            restrict: 'AE',\n            scope: {\n                pictureSuccess: '&newPicture',\n                buttonText: '@',\n                iconName: '@',\n                url: '@'\n            },\n            template:\n            '<ev-upload settings=\"settings\" file-success=\"pictureSuccess({picture: file})\"' +\n                'upload=\"newUpload(promise)\">' +\n                '<div ng-hide=\"uploading\">' +\n                    '<button type=\"button\" tabIndex=\"-1\" class=\"btn btn-link ev-upload-clickable\">' +\n                        '<span class=\"icon {{iconName}}\"></span>' +\n                       '{{buttonText}}' +\n                    '</button>' +\n                '</div>' +\n                '<div class=\"ev-picture-uploading\" ng-show=\"uploading\">' +\n                    '<div class=\"ev-picture-upload-label\"> {{\"Upload en cours\"| i18n}} </div>' +\n                    '<div class=\"spinner\"></div>' +\n                    '<p> {{upload.done}} / {{upload.total}} {{ \"photo(s) uploadée(s)\" | i18n }} </p>' +\n                '</div>' +\n                '<div ng-show=\"uploading\" ev-promise-progress=\"uploadPromise\"></div>' +\n            '</ev-upload>',\n\n            link: function ($scope) {\n                $scope.settings = {\n                    acceptedFiles: 'image/*',\n                    url: $scope.url\n                };\n            },\n            controller: function ($scope) {\n                $scope.$watch('url', function (url) {\n                    $scope.settings.url = url;\n                });\n                $scope.uploading = false;\n\n                $scope.newUpload = function (upload) {\n                    $scope.upload = null;\n                    $scope.uploading = true;\n                    $scope.uploadPromise = upload;\n                    upload\n                        .then(\n                            function success () {\n                                NotificationsService.addSuccess({\n                                    text: 'Les images ont été uploadées avec succès'\n                                });\n                            },\n                            function error () {\n                                NotificationsService.add({\n                                    type: NotificationsService.type.WARNING,\n                                    text: 'Certaines images n\\'ont pas pu être uploadées.'\n                                });\n                            },\n                            function onNotify (progress) {\n                                $scope.upload = progress;\n                            }\n                        )\n                        .finally(function () {\n                            $scope.uploading = false;\n                        });\n                };\n            }\n        };\n}]);\n}) ();\n","; (function () {\n'use strict';\nangular.module('ev-upload')\n    .directive('evPictureUpload', ['NotificationsService', '$http', function (NotificationsService, $http) {\n\n/*  ev-picture-upload\n    =================\n    Hi! I'm a directive used for uploading pictures. I'm based on the `ev-upload` directive. But I can also\n    manage flickr uploads !\n\n    You can parameter me with:\n    - `url`:  which is the place where I'll upload the pictures\n    - `pictureSuccess`:  a function called each time a picture has successfully been uploaded (by flickr\n        or manually). The picture is passed as argument.\n\n*/\n        return {\n            restrict: 'AE',\n            scope: {\n                pictureSuccess: '&newPicture',\n                url: '@'\n            },\n            template:\n            '<ev-upload settings=\"settings\" file-success=\"pictureSuccess({picture: file})\"' +\n                'class=\"ev-picture-upload\" upload=\"newUpload(promise)\">' +\n                '<div ng-hide=\"uploading\">' +\n                    '<div class=\"ev-picture-upload-label\">{{ \"Faites glisser vos images ici\" | i18n }}</div>' +\n                    '<table style=\"width:100%\"><tr><td style=\"width:114px\">'+\n                            '<button type=\"button\" tabIndex=\"-1\" class=\"btn btn-default ev-upload-clickable\">' +\n                                '{{ \"Importer...\" | i18n}}' +\n                            '</button>' +\n                        '</td>'+\n                        '<td style=\"width:30px´; line-height: 36px;\">'+\n                            '{{ \"ou\" | i18n }}' +\n                        '</td>'+\n                        '<td>'+\n                            '<form novalidate name=\"flickr\" ' +\n                                'ng-class=\"{\\'has-error\\': flickr.$dirty && flickr.$invalid}\">' +\n                                '<input name=\"fUrl\" placeholder=\"{{\\'Lien Flickr\\' | i18n}}\" ' +\n                                    'ng-model=\"$parent.flickrUrl\" ng-pattern=\"flickrUrlPattern\" required=\"\" ' +\n                                    'class=\"form-control\" ng-change=\"uploadFlickrUrl(flickr)\"/>' +\n                                '<div ng-show=\"flickr.fUrl.$dirty && flickr.fUrl.$invalid\">' +\n                                    '<p class=\"control-label\" for=\"fUrl\" data-ng-show=\"flickr.fUrl.$error.pattern\">'+\n                                        '{{ \"L\\'url doit être une photo flickr\" | i18n}}</p>' +\n                                '</div>' +\n                            '</form>' +\n                        '</td></tr></table>'+\n                '</div>' +\n                '<div class=\"ev-picture-uploading\" ng-show=\"uploading\">' +\n                    '<div class=\"ev-picture-upload-label\"> {{\"Upload en cours\"| i18n}} </div>' +\n                    '<div class=\"spinner\"></div>' +\n                    '<p> {{upload.done}} / {{upload.total}} {{ \"photo(s) uploadée(s)\" | i18n }} </p>' +\n                '</div>' +\n                '<div ng-show=\"uploading\" ev-promise-progress=\"uploadPromise\"></div>' +\n            '</ev-upload>',\n\n            link: function ($scope) {\n                $scope.flickrUrlPattern = /^(https\\:\\/\\/)?www\\.flickr\\.com\\/photos\\/.*\\/\\d+.*$/;\n                $scope.settings = {\n                    acceptedFiles: 'image/*',\n                    url: $scope.url\n                };\n            },\n            controller: function ($scope) {\n                $scope.$watch('url', function (url) {\n                    $scope.settings.url = url;\n                });\n                $scope.uploading = false;\n                $scope.uploadFlickrUrl = function (flickrForm) {\n                    /* Trailing the ends in order to have a https://www.flickr.com/photos/{user-id}/{photo-id} url\n                        Warning: `.*` is greedy, so an address like:\n                            https://www.flickr.com/photos/{user-id}/{photo-id}/blabla/1512\n                        will not be parsed nicely\n                     */\n                    if (!flickrForm.$valid) { return; }\n                    var flickrUrl = /(https\\:\\/\\/)?www\\.flickr\\.com\\/photos\\/.*\\/\\d+/ .exec($scope.flickrUrl)[0];\n                    var uploadPromise = $http.post($scope.url, {'flickr-url': flickrUrl});\n                    uploadPromise\n                        .success(function (response) {\n                            $scope.pictureSuccess({picture: response});\n                        })\n                        .success(function () {\n                            flickrForm.$setPristine();\n                            $scope.flickrUrl = \"\";\n                        });\n\n                    $scope.newUpload(uploadPromise);\n                    $scope.upload = {\n                        done: 0,\n                        total: 1,\n                        progress: 0\n                    };\n                };\n\n                $scope.newUpload = function (upload) {\n                    $scope.upload = null;\n                    $scope.uploading = true;\n                    $scope.uploadPromise = upload;\n                    upload\n                        .then(\n                            function success () {\n                                NotificationsService.addSuccess({\n                                    text: 'Les images ont été uploadées avec succès'\n                                });\n                            },\n                            function error () {\n                                NotificationsService.add({\n                                    type: NotificationsService.type.WARNING,\n                                    text: 'Certaines images n\\'ont pas pu être uploadées.'\n                                });\n                            },\n                            function onNotify (progress) {\n                                $scope.upload = progress;\n                            }\n                        )\n                        .finally(function () {\n                            $scope.uploading = false;\n                        });\n                };\n            }\n        };\n}]);\n}) ();\n","/* global Dropzone */\n; (function (Dropzone) {\n    'use strict';\n    angular.module('ev-upload')\n        .directive('evUpload', ['$log', '$q', '$timeout', function ($log, $q, $timeout) {\n\n    /*  ev-upload\n        =========\n        Hi! I'm a directive used for uploading files.\n\n        You can give me three callback: `uploadStart`, `fileSuccess` and `fileAdded`\n        - `uploadStart` will be called when a new multiple upload start (for instance, when the user dropped some files\n            on the dropzone). It will be call with an argument: the promise for the status of the whole upload.\n        - `fileSuccess` will be called each time a file has successfully been uploaded, with the data returned by the\n            server.\n        - `fileAdded` will be called each time a file is added to the queue. It will be called with 3 arguments :\n            - dropzoneFile : the Dropzone file being uploaded\n            - promise : the promise associated with the file\n            - cancel : a function that can be called to cancel the upload of the file.\n\n        Clickable Element : you can define a clickable element inside the directive with the\n                            class '.ev-upload-clickable'\n\n        Dropzone Element : you can define a clickable element inside the directive with the class '.ev-upload-dropzone'\n                           If the class is not present, it will use the root element.\n\n        My inner heart is powered by Dropzone. You can pass any settings to it through my `settings` parameter.\n        Consequently, you can do whatever you want. Be wise :)\n\n        ** Careful, if you change the settings parameters, all the current upload will be canceled, as a new dropzone\n        object will be created. **\n    */\n\n        var BASE_CONFIG = {\n            previewTemplate: false,\n            previewsContainer: false,\n            autoQueue: true,\n            maxFilesize: 12,\n            maxFiles: 100,\n\n            uploadMultiple: false,\n            parallelUploads: 3\n        };\n\n            return {\n                transclude: true,\n                restrict: 'EA',\n                replace: true,\n                scope: {\n                    settings: '=',\n                    uploadStart: '&upload',\n                    fileSuccess: '&',\n                    fileAdded: '&'\n                },\n                template: '<div class=\"ev-upload\"><div ng-transclude> </div></div>',\n                link: function ($scope, elem, attrs) {\n\n                    $scope.fileSuccess = $scope.fileSuccess || function() {};\n                    $scope.fileAdded = $scope.fileAdded || function() {};\n\n                    var dropzone = null;\n                    var progress = null;\n\n                    var filesPromises = {};\n                    function getBytes (status) {\n                        return dropzone.getAcceptedFiles().reduce(function (bytes, file) {\n                            return bytes + file.upload[status];\n                        }, 0);\n                    }\n\n                    function getDropzoneElement() {\n                        var dz = elem.find('.ev-upload-dropzone');\n                        if (dz.length === 0) {\n                            dz = elem;\n                        }\n                        dz.addClass(\"dz-default\");\n                        dz.addClass(\"dz-message\");\n                        return dz[0];\n                    }\n\n                    function getClickableElement() {\n                        return elem.find('.ev-upload-clickable')[0];\n                    }\n\n                    $scope.$watch('settings', function (settings) {\n                        if (!settings.url) {\n                            $log.warn('No url provided to the upload zone');\n                            return;\n                        }\n                        if (dropzone !== null) {\n                            dropzone.destroy();\n                        }\n                        settings = angular.extend(BASE_CONFIG, settings);\n                        dropzone = new Dropzone(\n                            getDropzoneElement(),\n                            angular.extend({clickable: getClickableElement()},settings)\n                        );\n                        // the promise for the whole upload\n\n                        $scope.currentUpload = null;\n\n                        // When a file is added to the queue\n                        dropzone.on('addedfile', function (file) {\n                            if ($scope.currentUpload === null) {\n                                $scope.$apply(startNewUpload);\n                            }\n                            var deferred = $q.defer();\n                            filesPromises[file.name] = deferred;\n                            var cancel = function () {\n                                dropzone.removeFile(file);\n                            };\n                            $scope.$apply(function($scope) {\n                                $scope.fileAdded({\n                                    dropzoneFile: file,\n                                    promise: deferred.promise,\n                                    cancel: cancel\n                                });\n                            });\n                        });\n\n                        dropzone.on('uploadprogress', function (file, progress) {\n                            $scope.$apply(function ($scope) {\n                                filesPromises[file.name].notify(progress);\n                            });\n                        });\n\n                        dropzone.on('success', function (file, response) {\n                            $scope.$apply(function ($scope) {\n                                filesPromises[file.name].resolve({file: response});\n                                $scope.fileSuccess({file: response});\n                            });\n                        });\n\n                        dropzone.on('error', function (file, response, xhr) {\n                            if (!response && xhr.status === 500) {\n                                response = settings.dictResponseError || 'Unexpected error during the upload';\n                            }\n                            if (response === 'Upload canceled.') {\n                                response = settings.dictCanceledUpload || 'The upload has been canceled';\n                            }\n                            $scope.$apply(function ($scope) {\n                                filesPromises[file.name].reject(response);\n                            });\n                        });\n\n                        dropzone.on('canceled', function (file) {\n                            var deferred = filesPromises[file.name];\n                            $scope.$apply(function ($scope) {\n                                deferred.reject(settings.dictCanceledUpload || 'The upload has been canceled');\n                            });\n                        });\n\n                        dropzone.on('complete', function (file) {\n                            if(angular.isDefined(progress)){\n                                progress.done += 1;\n                            }\n                        });\n\n                    }, true);\n\n                    // Create a new overall upload object\n                    function startNewUpload($scope) {\n                        progress = {\n                            done: 0,\n                            progress: 0\n                        };\n\n                        var computeOverallProgress = function () {\n                            progress.progress = 100 * getBytes('bytesSent') / getBytes('total');\n                            progress.total = dropzone.getAcceptedFiles().length;\n                            upload.deferred.notify(progress);\n                        };\n\n                        // De-register all events\n                        dropzone\n                            .off('uploadprogress', computeOverallProgress)\n                            .off('maxfilesexceeded');\n\n                        // upload object, encapsulate the state of the current (multi file) upload\n                        var upload = {\n                            deferred: $q.defer(),\n                            hasFileErrored: false,\n                        };\n                        computeOverallProgress();\n\n                        dropzone.once('error', function() {\n                            upload.hasFileErrored = true;\n                        });\n\n\n                        dropzone.on('uploadprogress', computeOverallProgress);\n\n                        var isUploadComplete = function () {\n                            return !dropzone.files.filter(function (file) {\n                                return file.status === Dropzone.QUEUED ||\n                                file.status === Dropzone.ADDED ||\n                                file.status === Dropzone.UPLOADING;\n                            }).length;\n                        };\n\n                        var stopIfComplete = function () {\n                            $scope.$apply(function ($scope) {\n                                $timeout(function () {\n                                    if ( !isUploadComplete() ) { return; }\n                                    dropzone.off('complete', stopIfComplete);\n                                    $timeout(function () {\n                                        if (upload.hasFileErrored) {\n                                            upload.deferred.reject('filehaserrored');\n                                        } else {\n                                            upload.deferred.resolve();\n                                        }\n                                    });\n                                });\n                            });\n                        };\n\n                        dropzone.on('maxfilesexceeded', function() {\n                            upload.deferred.reject('maxfilesexceeded');\n                        });\n                        dropzone.on('complete', stopIfComplete);\n\n                        $scope.currentUpload = upload.deferred.promise;\n                        $scope.uploadStart({promise: upload.deferred.promise});\n                        $scope.currentUpload.finally(function () {\n                            dropzone.removeAllFiles(true);\n                            $scope.currentUpload = null;\n                        });\n\n                    }\n\n                    $scope.$on('$destroy', function () {\n                        dropzone.destroy();\n                    });\n                }\n            };\n        }]);\n}(Dropzone));"],"sourceRoot":"/source/"}